class a{constructor(t,e,n=70,i,s){this._color="white",this.agent=null,this.i=i,this.j=s,this._x=t,this._y=e,this._size=n}get color(){return this._color}set color(t){this._color=t}get x(){return this._x}set x(t){this._x=t}get y(){return this._y}set y(t){this._y=t}get size(){return this._size}set size(t){this._size=t}draw(t){t.fillStyle=this._color,t.fillRect(this._x,this._y,this._size,this._size),t.strokeStyle="rgba(0, 0, 0, 0.3)",t.strokeRect(this._x,this._y,this._size,this._size),t.font="bold 10px Arial",t.fillStyle="rgba(0, 0, 0, 0.9)",t.fillText(`${this._x},${this._y}`,this._x+2,this._y+16)}}class g extends a{constructor(t,e,n,i,s){super(t,e,n,i,s),this._itemsCount=1,this.agent="good"}get itemsCount(){return this._itemsCount}incrementItemsCount(){this._itemsCount++}decrementItemsCount(){this._itemsCount--}drawGood(t){t.beginPath(),t.fillStyle="green",t.arc(this.x+this.size/4,this.y+this.size/4,this.size/4,0,Math.PI*2),t.fill(),t.fillStyle="white",t.font=`${this.size/3}px Arial`,t.textAlign="center",t.textBaseline="middle",t.fillText(this._itemsCount.toString(),this.x+this.size/4,this.y+this.size/4)}}class u extends a{constructor(t,e,n,i,s){super(t,e,n,i,s),this._directionToQueen={x:0,y:0},this._distanceToQueen=0,this._directionToFood={x:0,y:0},this._foodSmellStrength=0,this._pheromoneLevel=0,this._hasPheromone=!1,this._isAlive=!0,this.agent="ant"}get isAlive(){return this._isAlive}get directionToQueen(){return this._directionToQueen}get distanceToQueen(){return this._distanceToQueen}get directionToFood(){return this._directionToFood}get foodSmellStrength(){return this._foodSmellStrength}get pheromoneLevel(){return this._pheromoneLevel}get hasPheromone(){return this._hasPheromone}updateFoodInfo(t,e,n){const i=t-this.x,s=e-this.y,o=Math.sqrt(i*i+s*s);o===0?(this._directionToFood={x:0,y:0},this._foodSmellStrength=1):(this._directionToFood={x:i/o,y:s/o},this._foodSmellStrength=Math.max(0,1-o/n))}updateQueenInfo(t,e){const n=t-this.x,i=e-this.y,s=Math.sqrt(n*n+i*i);s===0?(this._directionToQueen={x:0,y:0},this._distanceToQueen=0):(this._directionToQueen={x:n/s,y:i/s},this._distanceToQueen=s)}leavePheromone(t){this._pheromoneLevel=t,this._hasPheromone=!0}clearPheromone(){this._pheromoneLevel=0,this._hasPheromone=!1}move(t,e){this.isAlive&&(this.x=t,this.y=e)}die(){this._isAlive=!1}}class f extends a{constructor(t,e,n,i,s,o){super(t,e,n,i,s),this._foodCount=0,this._maxFoodCount=10,this.agent="queen",this._color="purple",this._foodCount=o}tick(){this.isAlive()}createAnt(t,e,n,i){return t&&Math.random()<e?new u(this._x,this._y,this.size,i):!t&&Math.random()<n?new u(this._x,this._y,this.size,i):null}isAlive(){return this._foodCount<this._maxFoodCount}drawQueen(t){super.draw(t);const e=this._x+this.size/2,n=this._y+this.size/2,i=this.size/3;t.beginPath(),t.arc(e,n,i,0,Math.PI*2),t.fillStyle="purple",t.fill(),t.strokeStyle="darkpurple",t.stroke();const s=this._foodCount/this._maxFoodCount,o=4,r=this.size*.8,l=this._x+this.size*.1,d=this._y+this.size-o-2;t.fillStyle="rgba(255, 255, 255, 0.5)",t.fillRect(l,d,r,o),t.fillStyle=`rgba(255, 0, 0, ${s})`,t.fillRect(l,d,r*s,o)}}class m{constructor(t){this._board=[],this._rows=100,this._cols=100,this._cellSize=70,this.queensCount=t.queensCount,this.createAntWithFoodProbability=t.createAntWithFoodProbability,this.createAntWithoutFoodProbability=t.createAntWithoutFoodProbability,this.goodsCount=t.goodsCount,this.queenDeathSteps=t.queenDeathSteps,this.antDeathSteps=t.antDeathSteps,this._canvas=t.canvas,this._ctx=this._canvas.getContext("2d")}init({size:t}){this._updateBoardSize(t),this._canvas.width=this._rows*this._cellSize,this._canvas.height=this._cols*this._cellSize,this._fillBoard(),this._drawBoard(),this.createInitialEntities(this.queensCount,"queen"),this.createInitialEntities(this.goodsCount,"good")}get board(){return this._board}createInitialEntities(t,e){const n=[];for(let i=0;i<t;i++){let s,o;do s=Math.floor(Math.random()*this._rows),o=Math.floor(Math.random()*this._cols);while(n.find(r=>r.i===s&&r.j===o));if(this._board[s][o].agent!==null){i--;continue}n.push(this._board[s][o])}n.forEach(i=>{let s;e==="queen"?(s=new f(i.x,i.y,this._cellSize,i.i,i.j,this.queenDeathSteps),s.drawQueen(this._ctx)):(s=new g(i.x,i.y,this._cellSize,i.i,i.j),s.drawGood(this._ctx)),this._board[i.i][i.j]=s})}step(){this._board.forEach(t=>{t.forEach(e=>{e.agent==="good"&&(e.itemsCount<10&&e.incrementItemsCount(),e.drawGood(this._ctx))})})}_updateBoardSize(t){this._rows=t.n,this._cols=t.m}_fillBoard(){for(let t=0;t<this._rows;t++){this._board[t]=[];for(let e=0;e<this._cols;e++)this._board[t][e]=new a(e*this._cellSize,t*this._cellSize,this._cellSize,t,e)}}_drawBoard(){this._ctx.beginPath();for(let t=0;t<this._board.length;t++)for(let e=0;e<this._board[t].length;e++)this._board[t][e].draw(this._ctx)}}const p=({initial:h,onChange:t})=>{let e=h.n,n=h.m;const i=document.createElement("div"),s=document.createElement("input");s.type="number",s.value=e.toString(),s.addEventListener("change",()=>{e=parseInt(s.value)}),i.appendChild(s);const o=document.createElement("input");o.type="number",o.value=n.toString(),o.addEventListener("change",()=>{n=parseInt(o.value)}),i.appendChild(o);const r=document.createElement("button");return r.textContent="Apply size",i.appendChild(r),r.addEventListener("click",()=>{t({n:e,m:n})}),i},_={n:10,m:10};class y{constructor(t){this.isRunning=!1,this.tickInterval=1e3,this.intervalId=null,this.gameSettings={queensCount:5,createAntWithFoodProbability:.5,createAntWithoutFoodProbability:.5,goodsCount:5,queenDeathSteps:3,antDeathSteps:3},this.container=t;const e=document.createElement("canvas");this.container.appendChild(e),this.board=new m({canvas:e,...this.gameSettings})}start(){if(this.isRunning)return;this.board.init({size:_});const t=p({initial:_,onChange:e=>this.board.init({size:e})});this.container.prepend(t),this.isRunning=!0,this.intervalId=setInterval(()=>{this.tick()},this.tickInterval)}stop(){this.isRunning&&(this.isRunning=!1,this.intervalId!==null&&(clearInterval(this.intervalId),this.intervalId=null))}tick(){this.board.step()}setTickInterval(t){this.tickInterval=t,this.isRunning&&(this.stop(),this.start())}get running(){return this.isRunning}}const c=document.getElementById("app");c&&new y(c).start();
